<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>Hi all! </p> <p>I hope that you are doing well, safe and healthy!</p> <p>In this journal, I would like to share and explain a case study related to one of the great features of Google Kubernetes Engine (GKE). Yup, it is a <strong>Backup for GKE</strong>. As the name suggests, this feature is intended to back up and restore the workloads in the Kubernetes cluster we have on Google Cloud. </p> <p>What can be backed up?:</p> <ul class="wp-block-list"> <li> <strong>Configuration</strong>: Kubernetes resource including manifest and the cluster state.</li> <li> <strong>Volume backups</strong>: Application data that correspond to PersistentVolumeClaim resources</li> </ul> <p>There are many possible scenarios that we can choose to back up and restore the cluster. For example, we can only back up the configuration and restore it to the newly created cluster, or we can also back up the entire cluster and restore it to the source cluster for disaster recovery that may happen. Besides that, we can also set a scheduler job to run back up automatically. It will save our lives when shocking incidents unexpectedly happen.</p> <p>From the main documentation <a href="https://cloud.google.com/kubernetes-engine/docs/add-on/backup-for-gke/concepts/backup-for-gke" rel="external nofollow noopener" target="_blank">here</a>, there are two main components to focus on. A <strong>service</strong> and an <strong>agent</strong>. A service has the ability to serve as a controller for Backup for GKE service, and the agent will run automatically in the cluster where backups or restores are performed. Below is the diagram architecture:</p> <div class="wp-block-image"> <figure class="aligncenter size-large"><img loading="lazy" width="777" height="411" data-attachment-id="10753" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-94-5/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-94.png" data-orig-size="777,411" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-94" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-94.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-94.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-94.png?w=777" alt="" class="wp-image-10753" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-94.png 777w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-94.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-94.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-94.png?w=768 768w" sizes="(max-width: 777px) 100vw, 777px"></figure> </div> <p>As you may know, in the previous journal, I already wrote about Velero. One of the open-source tools which has a similar function to Backup for GKE. So, what is the difference between both? Based on my perspective, Backup for GKE is more simplified and requires less effort than Velero. You do not necessarily download the binary and install it like Velero. Also, Backup for GKE is more integrated into GKE and GCP services as common like IAM, Cloud Storage Bucket, etc. </p> <p>But, if you were more familiar with Velero as you’re used it in another Kubernetes environment cluster before, and you want to use Backup for GKE now, you need to adapt again . For example, in Backup for GKE you need to create a backup and restore plan as template before doing a backup and restore. Backup for GKE also gives us a challenge when we’ve already enjoy using it and we have to move in another cloud platform, we need to research and adapt again because this feature is native and proprietary. </p> <p>Backup for GKE is a separate service from GKE, so the pricing too. Based on the documentation <a href="https://cloud.google.com/kubernetes-engine/pricing#backup-for-gke" rel="external nofollow noopener" target="_blank">here</a>, we will be charged along two items. Backup management and also storage. And the pricing is different based on the region. So be careful!</p> <p>Now. In this journal, we will do a simple backup and restore scenario. I have a GKE cluster in us-central1 named gke-cluster1-a. There, I deploy a wordpress application with a persistent disk provided by PersistentVolumClaim and execute backup regularly every hour. Then I create a new GKE cluster named <strong>gke-cluster1-b, </strong>and try to restore the backup created before to test and ensure that the backup runs smoothly and successfully.</p> <p>What will I back up? GKE cluster configuration and wordpress data stored on persistent disk. So, when the restore is complete, wordpress is automatically loaded and can be accessed from outside.</p> <div class="wp-block-image"> <figure class="aligncenter size-large"><img loading="lazy" width="651" height="311" data-attachment-id="10719" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/gcp-page-1-drawio/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/gcp-page-1.drawio.png" data-orig-size="651,311" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="gcp-page-1.drawio" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/gcp-page-1.drawio.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/gcp-page-1.drawio.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/gcp-page-1.drawio.png?w=651" alt="" class="wp-image-10719" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/gcp-page-1.drawio.png 651w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/gcp-page-1.drawio.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/gcp-page-1.drawio.png?w=300 300w" sizes="(max-width: 651px) 100vw, 651px"></figure> </div> <p></p> <p>As I writing this journal, Backup for GKE still has a limitation for backup storage(PVC). It is only support for multi-zone (intra-region) and doesn’t support multi-region yet. So, I will only using <strong>us-central1 </strong>region for backup and restore. </p> <p>Okay! Let’s jump in!</p> <p></p> <p>Here, I will use Google Cloud SDK instead of Google Cloud Console. So, I will define the environment variables first like below:</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726783" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-define-env-gcp" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="define-env-gcp content, created by misskecupbung on 04:25PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="define-env-gcp"> <tr> <td id="file-define-env-gcp-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-define-env-gcp-LC1" class="blob-code blob-code-inner js-file-line"># Define env variables</td> </tr> <tr> <td id="file-define-env-gcp-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-define-env-gcp-LC2" class="blob-code blob-code-inner js-file-line">export PROJECT_ID=$(gcloud config get-value project)</td> </tr> <tr> <td id="file-define-env-gcp-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-define-env-gcp-LC3" class="blob-code blob-code-inner js-file-line">export PROJECT_USER=$(gcloud config get-value core/account)</td> </tr> <tr> <td id="file-define-env-gcp-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-define-env-gcp-LC4" class="blob-code blob-code-inner js-file-line">export PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID –format="value(projectNumber)")</td> </tr> <tr> <td id="file-define-env-gcp-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-define-env-gcp-LC5" class="blob-code blob-code-inner js-file-line">export IDNS=${PROJECT_ID}.svc.id.goog</td> </tr> <tr> <td id="file-define-env-gcp-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-define-env-gcp-LC6" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-define-env-gcp-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td> <td id="file-define-env-gcp-LC7" class="blob-code blob-code-inner js-file-line">export GCP_REGION="us-central1"</td> </tr> <tr> <td id="file-define-env-gcp-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td> <td id="file-define-env-gcp-LC8" class="blob-code blob-code-inner js-file-line">export GCP_ZONE="us-central1-c"</td> </tr> <tr> <td id="file-define-env-gcp-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td> <td id="file-define-env-gcp-LC9" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-define-env-gcp-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td> <td id="file-define-env-gcp-LC10" class="blob-code blob-code-inner js-file-line">export NETWORK_NAME="default"</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/220c64e0070d7d2cff92cdae4fcbeb98/raw/6b8082f249424adabaaa2cd0bf4b845b22ce605e/define-env-gcp" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/220c64e0070d7d2cff92cdae4fcbeb98#file-define-env-gcp" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> define-env-gcp </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <p>Make sure the configuration is correct, and then set the default region and zone based on the variables defined before.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726807" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-set-default-region-zone-gcp" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="set-default-region-zone-gcp content, created by misskecupbung on 04:26PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="set-default-region-zone-gcp"> <tr> <td id="file-set-default-region-zone-gcp-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-set-default-region-zone-gcp-LC1" class="blob-code blob-code-inner js-file-line">gcloud config set compute/region $GCP_REGION</td> </tr> <tr> <td id="file-set-default-region-zone-gcp-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-set-default-region-zone-gcp-LC2" class="blob-code blob-code-inner js-file-line">gcloud config set compute/zone $GCP_ZONE</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/e15c8c66329856f2dbbad4229416f4fc/raw/505cd5e880edcadaa9d95c40a6add4c3942cda0b/set-default-region-zone-gcp" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/e15c8c66329856f2dbbad4229416f4fc#file-set-default-region-zone-gcp" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> set-default-region-zone-gcp </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <p>We can verify with the command below:</p> <div class="wp-block-syntaxhighlighter-code "><pre class="brush: plain; title: ; notranslate">
gcloud config list
</pre></div> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="370" data-attachment-id="10651" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-66-8/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png" data-orig-size="1116,404" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-66" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png?w=1024" alt="" class="wp-image-10651" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png?w=1022 1022w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-66.png 1116w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>We need to enable three APIs that will be used for each service. Containers API will be used by GKE for computing, storage API will be used by GKE for persistent disk, and also GKE Backup for backup and restore tasks.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726819" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-enable-apis-gke" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="enable-apis-gke content, created by misskecupbung on 04:27PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="enable-apis-gke"> <tr> <td id="file-enable-apis-gke-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-enable-apis-gke-LC1" class="blob-code blob-code-inner js-file-line">gcloud services enable compute.googleapis.com \</td> </tr> <tr> <td id="file-enable-apis-gke-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-enable-apis-gke-LC2" class="blob-code blob-code-inner js-file-line"> container.googleapis.com \</td> </tr> <tr> <td id="file-enable-apis-gke-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-enable-apis-gke-LC3" class="blob-code blob-code-inner js-file-line"> storage.googleapis.com \</td> </tr> <tr> <td id="file-enable-apis-gke-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-enable-apis-gke-LC4" class="blob-code blob-code-inner js-file-line"> gkebackup.googleapis.com</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/c4645c5dc40380bac2476f6d9cc0634c/raw/39d2830ab954766afcda1192259c9b45256b4cf5/enable-apis-gke" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/c4645c5dc40380bac2476f6d9cc0634c#file-enable-apis-gke" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> enable-apis-gke </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="150" data-attachment-id="10595" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-45-9/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png" data-orig-size="1035,152" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-45" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png?w=1024" alt="" class="wp-image-10595" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-45.png 1035w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>We can verify the enabled services with command below:</p> <div class="wp-block-syntaxhighlighter-code "><pre class="brush: plain; title: ; notranslate">
gcloud services list --enabled
</pre></div> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="499" data-attachment-id="10597" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-46-9/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png" data-orig-size="1084,529" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-46" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png?w=1024" alt="" class="wp-image-10597" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-46.png 1084w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <p>Next. We have to create a GKE cluster. I create it as a public cluster with a multi-zones configuration in us-central1 region. Do not forget to add <strong>–addons=BackupRestore</strong> to install Backup for GKE agent in this cluster.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726830" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-create-new-cluster-gke" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="create-new-cluster-gke content, created by misskecupbung on 04:27PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="create-new-cluster-gke"> <tr> <td id="file-create-new-cluster-gke-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-create-new-cluster-gke-LC1" class="blob-code blob-code-inner js-file-line">export CLUSTER_NAME="gke-central1-a"</td> </tr> <tr> <td id="file-create-new-cluster-gke-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-create-new-cluster-gke-LC2" class="blob-code blob-code-inner js-file-line">gcloud beta container clusters create $CLUSTER_NAME \</td> </tr> <tr> <td id="file-create-new-cluster-gke-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-create-new-cluster-gke-LC3" class="blob-code blob-code-inner js-file-line"> –project=$PROJECT_ID \</td> </tr> <tr> <td id="file-create-new-cluster-gke-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-create-new-cluster-gke-LC4" class="blob-code blob-code-inner js-file-line"> –region=$LOCATION \</td> </tr> <tr> <td id="file-create-new-cluster-gke-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-create-new-cluster-gke-LC5" class="blob-code blob-code-inner js-file-line"> –addons=BackupRestore \</td> </tr> <tr> <td id="file-create-new-cluster-gke-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-create-new-cluster-gke-LC6" class="blob-code blob-code-inner js-file-line"> –num-nodes=1 \</td> </tr> <tr> <td id="file-create-new-cluster-gke-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td> <td id="file-create-new-cluster-gke-LC7" class="blob-code blob-code-inner js-file-line"> –enable-autoupgrade –no-enable-basic-auth \</td> </tr> <tr> <td id="file-create-new-cluster-gke-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td> <td id="file-create-new-cluster-gke-LC8" class="blob-code blob-code-inner js-file-line"> –no-issue-client-certificate –enable-ip-alias \</td> </tr> <tr> <td id="file-create-new-cluster-gke-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td> <td id="file-create-new-cluster-gke-LC9" class="blob-code blob-code-inner js-file-line"> –metadata disable-legacy-endpoints=true \</td> </tr> <tr> <td id="file-create-new-cluster-gke-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td> <td id="file-create-new-cluster-gke-LC10" class="blob-code blob-code-inner js-file-line"> –workload-pool=$IDNS </td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/653f687718d8cf94c8e6bba08833af9c/raw/9126ac76a0ce609a292357118a29587a8009f1f3/create-new-cluster-gke" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/653f687718d8cf94c8e6bba08833af9c#file-create-new-cluster-gke" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> create-new-cluster-gke </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="243" data-attachment-id="10653" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-67-8/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png" data-orig-size="1099,261" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-67" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png?w=1024" alt="" class="wp-image-10653" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-67.png 1099w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>Verify the cluster and make sure the state of all workers is <strong>Ready</strong>.</p> <div class="wp-block-syntaxhighlighter-code "><pre class="brush: plain; title: ; notranslate">
gcloud container clusters get-credentials $CLUSTER_NAME \
--region $GCP_REGION --project $PROJECT_ID

kubectl get nodes -o wide
</pre></div> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="252" data-attachment-id="10655" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-68-8/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png" data-orig-size="1366,337" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-68" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png?w=1024" alt="" class="wp-image-10655" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png?w=1021 1021w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-68.png 1366w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <p>For wordpress application, I am using the tutorial from <a href="https://kubernetes.io/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/" rel="external nofollow noopener" target="_blank">here</a>. You can follow along, or use your own application instead.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726848" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-deploy-wp-gke" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="deploy-wp-gke content, created by misskecupbung on 04:28PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="deploy-wp-gke"> <tr> <td id="file-deploy-wp-gke-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-deploy-wp-gke-LC1" class="blob-code blob-code-inner js-file-line"># create Kustomize file</td> </tr> <tr> <td id="file-deploy-wp-gke-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-deploy-wp-gke-LC2" class="blob-code blob-code-inner js-file-line">cat &gt; ./kustomization.yaml &lt;&lt; EOF</td> </tr> <tr> <td id="file-deploy-wp-gke-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-deploy-wp-gke-LC3" class="blob-code blob-code-inner js-file-line">secretGenerator:</td> </tr> <tr> <td id="file-deploy-wp-gke-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-deploy-wp-gke-LC4" class="blob-code blob-code-inner js-file-line">– name: mysql-pass</td> </tr> <tr> <td id="file-deploy-wp-gke-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-deploy-wp-gke-LC5" class="blob-code blob-code-inner js-file-line"> literals:</td> </tr> <tr> <td id="file-deploy-wp-gke-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-deploy-wp-gke-LC6" class="blob-code blob-code-inner js-file-line"> – password=gkebackup2022</td> </tr> <tr> <td id="file-deploy-wp-gke-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td> <td id="file-deploy-wp-gke-LC7" class="blob-code blob-code-inner js-file-line">EOF</td> </tr> <tr> <td id="file-deploy-wp-gke-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td> <td id="file-deploy-wp-gke-LC8" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-deploy-wp-gke-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td> <td id="file-deploy-wp-gke-LC9" class="blob-code blob-code-inner js-file-line"># download manifests</td> </tr> <tr> <td id="file-deploy-wp-gke-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td> <td id="file-deploy-wp-gke-LC10" class="blob-code blob-code-inner js-file-line">curl -LO <a href="https://k8s.io/examples/application/wordpress/mysql-deployment.yaml" rel="nofollow" target="_blank">https://k8s.io/examples/application/wordpress/mysql-deployment.yaml</a> </td> </tr> <tr> <td id="file-deploy-wp-gke-L11" class="blob-num js-line-number js-blob-rnum" data-line-number="11"></td> <td id="file-deploy-wp-gke-LC11" class="blob-code blob-code-inner js-file-line">curl -LO <a href="https://k8s.io/examples/application/wordpress/wordpress-deployment.yaml" rel="nofollow" target="_blank">https://k8s.io/examples/application/wordpress/wordpress-deployment.yaml</a> </td> </tr> <tr> <td id="file-deploy-wp-gke-L12" class="blob-num js-line-number js-blob-rnum" data-line-number="12"></td> <td id="file-deploy-wp-gke-LC12" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-deploy-wp-gke-L13" class="blob-num js-line-number js-blob-rnum" data-line-number="13"></td> <td id="file-deploy-wp-gke-LC13" class="blob-code blob-code-inner js-file-line"># update Kustomize file (note &gt;&gt; which appends original file)</td> </tr> <tr> <td id="file-deploy-wp-gke-L14" class="blob-num js-line-number js-blob-rnum" data-line-number="14"></td> <td id="file-deploy-wp-gke-LC14" class="blob-code blob-code-inner js-file-line">cat &gt;&gt; ./kustomization.yaml &lt;&lt; EOF</td> </tr> <tr> <td id="file-deploy-wp-gke-L15" class="blob-num js-line-number js-blob-rnum" data-line-number="15"></td> <td id="file-deploy-wp-gke-LC15" class="blob-code blob-code-inner js-file-line">resources:</td> </tr> <tr> <td id="file-deploy-wp-gke-L16" class="blob-num js-line-number js-blob-rnum" data-line-number="16"></td> <td id="file-deploy-wp-gke-LC16" class="blob-code blob-code-inner js-file-line"> – mysql-deployment.yaml</td> </tr> <tr> <td id="file-deploy-wp-gke-L17" class="blob-num js-line-number js-blob-rnum" data-line-number="17"></td> <td id="file-deploy-wp-gke-LC17" class="blob-code blob-code-inner js-file-line"> – wordpress-deployment.yaml</td> </tr> <tr> <td id="file-deploy-wp-gke-L18" class="blob-num js-line-number js-blob-rnum" data-line-number="18"></td> <td id="file-deploy-wp-gke-LC18" class="blob-code blob-code-inner js-file-line">EOF</td> </tr> <tr> <td id="file-deploy-wp-gke-L19" class="blob-num js-line-number js-blob-rnum" data-line-number="19"></td> <td id="file-deploy-wp-gke-LC19" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-deploy-wp-gke-L20" class="blob-num js-line-number js-blob-rnum" data-line-number="20"></td> <td id="file-deploy-wp-gke-LC20" class="blob-code blob-code-inner js-file-line"># deploy (using built-in kustomize feature of kubectl)</td> </tr> <tr> <td id="file-deploy-wp-gke-L21" class="blob-num js-line-number js-blob-rnum" data-line-number="21"></td> <td id="file-deploy-wp-gke-LC21" class="blob-code blob-code-inner js-file-line">kubectl apply -k ./</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/5c684cd1166a813d80c2868e303ef6c9/raw/b3dabaad97c18ee286e415863ba4b125f7441f22/deploy-wp-gke" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/5c684cd1166a813d80c2868e303ef6c9#file-deploy-wp-gke" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> deploy-wp-gke </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="277" data-attachment-id="10602" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-49-9/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png" data-orig-size="1229,333" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-49" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png?w=1024" alt="" class="wp-image-10602" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-49.png 1229w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>Make sure the pod is <strong>running</strong>, the external IP in the service appears, and the volume state is <strong>bound</strong>.</p> <div class="wp-block-syntaxhighlighter-code "><pre class="brush: plain; title: ; notranslate">
kubectl get pods
kubectl get svc
kubectl get pvc
</pre></div> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="281" data-attachment-id="10657" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-69-8/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png" data-orig-size="1239,341" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-69" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png?w=1024" alt="" class="wp-image-10657" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png?w=1021 1021w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-69.png 1239w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>Try to access the application from browser like below.</p> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="625" data-attachment-id="10660" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-70-8/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png" data-orig-size="1031,630" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-70" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png?w=1024" alt="" class="wp-image-10660" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-70.png 1031w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <p>Now, we are going to do back up strategy. We will back up the entire kubernetes cluster environment, including data volume and secrets.</p> <p>Before that, make sure the location can provide it, because not all regions can using command below:</p> <div class="wp-block-syntaxhighlighter-code "><pre class="brush: plain; title: ; notranslate">
gcloud alpha container backup-restore locations list \
    --project $PROJECT_ID
</pre></div> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="494" data-attachment-id="10613" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-55-8/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png" data-orig-size="1102,532" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-55" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png?w=1024" alt="" class="wp-image-10613" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-55.png 1102w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <p>For the backup strategy, we have to create a BackupPlan first. I will create it using environment variables that defined below</p> <div class="wp-block-syntaxhighlighter-code "><pre class="brush: plain; title: ; notranslate">
# Define env variables for GKE Backup
export BACKUP_PLAN="gke-central1-a-backup"
export LOCATION="us-central1"
export CLUSTER="projects/$PROJECT_ID/locations/$GCP_REGION/clusters/$CLUSTER_NAME"
export RETAIN_DAYS="3"
</pre></div> <p>And then, create a BackupPlan which will back up all namespaces, including secret and volume data. I also set the cron scheduler that will automatically back up every hour and set backup retention only for 3 days.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726869" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-create-backup-plan-gke" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="create-backup-plan-gke content, created by misskecupbung on 04:29PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="create-backup-plan-gke"> <tr> <td id="file-create-backup-plan-gke-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-create-backup-plan-gke-LC1" class="blob-code blob-code-inner js-file-line">gcloud alpha container backup-restore backup-plans create $BACKUP_PLAN \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-create-backup-plan-gke-LC2" class="blob-code blob-code-inner js-file-line"> –project=$PROJECT_ID \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-create-backup-plan-gke-LC3" class="blob-code blob-code-inner js-file-line"> –location=$LOCATION \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-create-backup-plan-gke-LC4" class="blob-code blob-code-inner js-file-line"> –cluster=$CLUSTER \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-create-backup-plan-gke-LC5" class="blob-code blob-code-inner js-file-line"> –all-namespaces \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-create-backup-plan-gke-LC6" class="blob-code blob-code-inner js-file-line"> –include-secrets \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td> <td id="file-create-backup-plan-gke-LC7" class="blob-code blob-code-inner js-file-line"> –include-volume-data \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td> <td id="file-create-backup-plan-gke-LC8" class="blob-code blob-code-inner js-file-line"> –cron-schedule="0 * * * *" \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td> <td id="file-create-backup-plan-gke-LC9" class="blob-code blob-code-inner js-file-line"> –backup-retain-days=$RETAIN_DAYS \</td> </tr> <tr> <td id="file-create-backup-plan-gke-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td> <td id="file-create-backup-plan-gke-LC10" class="blob-code blob-code-inner js-file-line"> –locked</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/27a4604f82656bd56dd5444f653d68c8/raw/904a9a876b9e5536c7af5cc8bc7edc02f245fc9b/create-backup-plan-gke" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/27a4604f82656bd56dd5444f653d68c8#file-create-backup-plan-gke" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> create-backup-plan-gke </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <p>Verify the backup plan newly created:</p> <div class="wp-block-syntaxhighlighter-code "><pre class="brush: plain; title: ; notranslate">
gcloud alpha container backup-restore backup-plans list \
--project=$PROJECT_ID \
--location=$LOCATION
</pre></div> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="212" data-attachment-id="10664" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-71-8/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png" data-orig-size="1106,230" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-71" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png?w=1024" alt="" class="wp-image-10664" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png?w=1019 1019w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-71.png 1106w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>We can also verify from the Cloud Console too</p> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="398" data-attachment-id="10665" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-72-8/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png" data-orig-size="1366,531" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-72" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png?w=1024" alt="" class="wp-image-10665" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-72.png 1366w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <p>How do we back up using BackupPlan created before? Using the command below will create a manually backup named <strong>manual-backup1</strong> with the appropriate BackupPlan, location, and project.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726881" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-create-manual-backup-gke" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="create-manual-backup-gke content, created by misskecupbung on 04:29PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="create-manual-backup-gke"> <tr> <td id="file-create-manual-backup-gke-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-create-manual-backup-gke-LC1" class="blob-code blob-code-inner js-file-line">export BACKUP=manual-backup1</td> </tr> <tr> <td id="file-create-manual-backup-gke-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-create-manual-backup-gke-LC2" class="blob-code blob-code-inner js-file-line">gcloud alpha container backup-restore backups create $BACKUP \</td> </tr> <tr> <td id="file-create-manual-backup-gke-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-create-manual-backup-gke-LC3" class="blob-code blob-code-inner js-file-line"> –project=$PROJECT_ID \</td> </tr> <tr> <td id="file-create-manual-backup-gke-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-create-manual-backup-gke-LC4" class="blob-code blob-code-inner js-file-line"> –location=$LOCATION \</td> </tr> <tr> <td id="file-create-manual-backup-gke-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-create-manual-backup-gke-LC5" class="blob-code blob-code-inner js-file-line"> –backup-plan=$BACKUP_PLAN \</td> </tr> <tr> <td id="file-create-manual-backup-gke-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-create-manual-backup-gke-LC6" class="blob-code blob-code-inner js-file-line"> –wait-for-completion</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/2e5c34216bdf65a74a8f839b3af26cd5/raw/02959f04319124531fc067b7df601b2184e86fda/create-manual-backup-gke" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/2e5c34216bdf65a74a8f839b3af26cd5#file-create-manual-backup-gke" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> create-manual-backup-gke </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="307" data-attachment-id="10667" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-73-7/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png" data-orig-size="1366,410" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-73" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png?w=1024" alt="" class="wp-image-10667" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-73.png 1366w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>Wait and ensure the backup is successful. </p> <p></p> <p>All right. After we do the back up the task. We need to test using restore to ensure that the backup is running correctly.</p> <p>First, I will create a second GKE cluster with the same specification like the cluster one.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726890" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-create-new-cluster-gke-2" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="create-new-cluster-gke-2 content, created by misskecupbung on 04:30PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="create-new-cluster-gke-2"> <tr> <td id="file-create-new-cluster-gke-2-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-create-new-cluster-gke-2-LC1" class="blob-code blob-code-inner js-file-line">export CLUSTER_NAME2="gke-central1-b"</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-create-new-cluster-gke-2-LC2" class="blob-code blob-code-inner js-file-line">gcloud beta container clusters create $CLUSTER_NAME2 \</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-create-new-cluster-gke-2-LC3" class="blob-code blob-code-inner js-file-line"> –project=$PROJECT_ID \</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-create-new-cluster-gke-2-LC4" class="blob-code blob-code-inner js-file-line"> –region=$LOCATION \</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-create-new-cluster-gke-2-LC5" class="blob-code blob-code-inner js-file-line"> –addons=BackupRestore \</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-create-new-cluster-gke-2-LC6" class="blob-code blob-code-inner js-file-line"> –num-nodes=1 \</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td> <td id="file-create-new-cluster-gke-2-LC7" class="blob-code blob-code-inner js-file-line"> –enable-autoupgrade –no-enable-basic-auth \</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td> <td id="file-create-new-cluster-gke-2-LC8" class="blob-code blob-code-inner js-file-line"> –no-issue-client-certificate –enable-ip-alias \</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td> <td id="file-create-new-cluster-gke-2-LC9" class="blob-code blob-code-inner js-file-line"> –metadata disable-legacy-endpoints=true \</td> </tr> <tr> <td id="file-create-new-cluster-gke-2-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td> <td id="file-create-new-cluster-gke-2-LC10" class="blob-code blob-code-inner js-file-line"> –workload-pool=$IDNS </td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/15f15b519c1f3e8aafc5dc6f305b9969/raw/482b2b8e68a5449ccfe2e6cf4c38a19b7be32273/create-new-cluster-gke-2" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/15f15b519c1f3e8aafc5dc6f305b9969#file-create-new-cluster-gke-2" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> create-new-cluster-gke-2 </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="344" data-attachment-id="10668" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-74-7/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png" data-orig-size="1192,401" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-74" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png?w=1024" alt="" class="wp-image-10668" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-74.png 1192w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>Same as BackupPlan, I define the environment variables:</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726904" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-export-vars-backup-gke" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="export-vars-backup-gke content, created by misskecupbung on 04:31PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="export-vars-backup-gke"> <tr> <td id="file-export-vars-backup-gke-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-export-vars-backup-gke-LC1" class="blob-code blob-code-inner js-file-line">export RESTORE_LOCATION="us-central1"</td> </tr> <tr> <td id="file-export-vars-backup-gke-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-export-vars-backup-gke-LC2" class="blob-code blob-code-inner js-file-line">export RESTORE_PLAN="gke-central1-b-restore"</td> </tr> <tr> <td id="file-export-vars-backup-gke-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-export-vars-backup-gke-LC3" class="blob-code blob-code-inner js-file-line">export CLUSTER2="projects/$PROJECT_ID/locations/$GCP_REGION/clusters/$CLUSTER_NAME2"</td> </tr> <tr> <td id="file-export-vars-backup-gke-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-export-vars-backup-gke-LC4" class="blob-code blob-code-inner js-file-line">export CLUSTER_RESOURCE_CONFLICT_POLICY="use-backup-version"</td> </tr> <tr> <td id="file-export-vars-backup-gke-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-export-vars-backup-gke-LC5" class="blob-code blob-code-inner js-file-line">export NAMESPACED_RESOURCE_RESTORE_MODE="delete-and-restore"</td> </tr> <tr> <td id="file-export-vars-backup-gke-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-export-vars-backup-gke-LC6" class="blob-code blob-code-inner js-file-line">export VOLUME_DATA_RESTORE_POLICY="restore-volume-data-from-backup"</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/1d568aca7fbafee52918c04b2e0a82bd/raw/6790cde832f234c923fb9013d1ac824dfa3a304d/export-vars-backup-gke" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/1d568aca7fbafee52918c04b2e0a82bd#file-export-vars-backup-gke" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> export-vars-backup-gke </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="239" data-attachment-id="10671" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-75-7/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png" data-orig-size="1366,319" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-75" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png?w=1024" alt="" class="wp-image-10671" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-75.png 1366w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>And do the manual restore with appropriate restore plan and the backup created before. </p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118726909" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-restore-gke" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="restore-gke content, created by misskecupbung on 04:31PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="restore-gke"> <tr> <td id="file-restore-gke-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-restore-gke-LC1" class="blob-code blob-code-inner js-file-line">export RESTORE="manual-restore1"</td> </tr> <tr> <td id="file-restore-gke-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-restore-gke-LC2" class="blob-code blob-code-inner js-file-line">gcloud alpha container backup-restore restores create $RESTORE \</td> </tr> <tr> <td id="file-restore-gke-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-restore-gke-LC3" class="blob-code blob-code-inner js-file-line"> –project=$PROJECT_ID \</td> </tr> <tr> <td id="file-restore-gke-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-restore-gke-LC4" class="blob-code blob-code-inner js-file-line"> –location=$GCP_REGION \</td> </tr> <tr> <td id="file-restore-gke-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-restore-gke-LC5" class="blob-code blob-code-inner js-file-line"> –restore-plan=$RESTORE_PLAN \</td> </tr> <tr> <td id="file-restore-gke-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-restore-gke-LC6" class="blob-code blob-code-inner js-file-line"> –backup=projects/$PROJECT_ID/locations/$LOCATION/backupPlans/$BACKUP_PLAN/backups/$BACKUP \</td> </tr> <tr> <td id="file-restore-gke-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td> <td id="file-restore-gke-LC7" class="blob-code blob-code-inner js-file-line"> –wait-for-completion</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/2908c8742415fabf3731f79946abbe99/raw/6579fdd2f7d6eb072e1c7a1232ef7eac1d109784/restore-gke" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/2908c8742415fabf3731f79946abbe99#file-restore-gke" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> restore-gke </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="174" data-attachment-id="10674" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-76-6/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png" data-orig-size="1335,228" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-76" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png?w=1024" alt="" class="wp-image-10674" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png?w=1019 1019w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-76.png 1335w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>Wait until the restore is successful. Verify the pods is running, PVC are bounds, and the external IP is accessible</p> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="332" data-attachment-id="10676" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-77-6/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png" data-orig-size="1366,443" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-77" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png?w=1024" alt="" class="wp-image-10676" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-77.png 1366w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="645" data-attachment-id="10677" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-strategy-on-google-kubernetes-engine-gke/image-78-6/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png" data-orig-size="1033,651" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-78" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png?w=1024" alt="" class="wp-image-10677" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/09/image-78.png 1033w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <p></p> <p></p> <p>References:</p> <ol class="wp-block-list"> <li><a href="https://cloud.google.com/kubernetes-engine/docs/add-on/backup-for-gke/concepts/backup-for-gke" rel="external nofollow noopener" target="_blank">https://cloud.google.com/kubernetes-engine/docs/add-on/backup-for-gke/concepts/backup-for-gke</a></li> <li><a href="https://cloud.google.com/kubernetes-engine/docs/add-on/backup-for-gke/how-to/install" rel="external nofollow noopener" target="_blank">https://cloud.google.com/kubernetes-engine/docs/add-on/backup-for-gke/how-to/install</a></li> </ol> <p></p> <p></p> <p>Cheers!</p> </body></html>