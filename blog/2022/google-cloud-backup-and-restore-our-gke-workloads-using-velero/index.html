<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>Hi all!</p> <p></p> <p>I hope that you are doing well. In this journal, I will explain the backup and restore strategy for Kubernetes using Velero, specifically in Google Kubernetes Engine (GKE).</p> <p>As you may know, Velero is one of the great open-source tools which can be used to back up and restore (including migrate and replicate) our existing Kubernetes cluster. It has lots of features which we can use. First, absolutely it is open source. We can use Velero in all most Kubernetes environments. For example, on-premise, Google Kubernetes (GKE), or other public clouds. So, if you are already using Velero in another environment, you will easily adapt to it in GKE. </p> <p>Based on the main documentation <a href="https://velero.io/docs/v1.9/" rel="external nofollow noopener" target="_blank">here</a>, there are many use cases that we can use to implement using Velero, for example, backup filtering. Velero is also easy to use. We just have to install the binary and a bit of configuration to connect to the cluster, and it is ready to do backup and restore. </p> <p>But, in this case, there are many limitations on Velero too. First, Velero does not natively support the migration of persistent volumes snapshots across cloud providers. If we want to do it, we need to enable <a href="https://velero.io/docs/v1.9/restic/" rel="external nofollow noopener" target="_blank">Restic</a>. Velero also does not support do restore into a cluster with a lower Kubernetes version than where the backup was taken. So, we need to ensure the version is properly and carefully. </p> <p>Maybe, in previous experience, you’ve already tried Velero to execute backup and restore on-premise Kubernetes environment. This is the most common use case, but storage is one of the benefits of using the public cloud. We don’t necessarily to taking care of the backup storage because (for example, in GCP, we are using cloud storage) it is fully managed. </p> <p>We just have to create a backup (if we don’t have one) that is ready to use. </p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118728564" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-create-bucket-cloudstorage-gcp" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="create-bucket-cloudstorage-gcp content, created by misskecupbung on 06:18PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="create-bucket-cloudstorage-gcp"> <tr> <td id="file-create-bucket-cloudstorage-gcp-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-create-bucket-cloudstorage-gcp-LC1" class="blob-code blob-code-inner js-file-line">BUCKET=velero-backup-anandadwi</td> </tr> <tr> <td id="file-create-bucket-cloudstorage-gcp-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-create-bucket-cloudstorage-gcp-LC2" class="blob-code blob-code-inner js-file-line">gsutil mb gs://$BUCKET/</td> </tr> <tr> <td id="file-create-bucket-cloudstorage-gcp-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-create-bucket-cloudstorage-gcp-LC3" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-create-bucket-cloudstorage-gcp-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-create-bucket-cloudstorage-gcp-LC4" class="blob-code blob-code-inner js-file-line"># verify</td> </tr> <tr> <td id="file-create-bucket-cloudstorage-gcp-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-create-bucket-cloudstorage-gcp-LC5" class="blob-code blob-code-inner js-file-line">gsutil ls</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/01339b4de363e4bdb669df4c893e3fcf/raw/ad054c4a2650022e10e861a81d39af06b7d449b9/create-bucket-cloudstorage-gcp" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/01339b4de363e4bdb669df4c893e3fcf#file-create-bucket-cloudstorage-gcp" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> create-bucket-cloudstorage-gcp </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large is-resized"><img loading="lazy" data-attachment-id="10774" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-280/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image.png" data-orig-size="778,149" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image.png?w=778" alt="" class="wp-image-10774" width="842" height="161" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image.png 778w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image.png?w=768 768w" sizes="(max-width: 842px) 100vw, 842px"></figure> <p>Because Velero needs access the resources and the storage, we need to create a service account and define the permission. The permission must be attached to the service account is get, create, and delete. So the resources are accessible from Velero.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118728863" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-velero-create-sa" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="velero-create-sa content, created by misskecupbung on 06:38PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="velero-create-sa"> <tr> <td id="file-velero-create-sa-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-velero-create-sa-LC1" class="blob-code blob-code-inner js-file-line">gcloud iam service-accounts create velero-backup-anandadwi –display-name "Velero SA"</td> </tr> <tr> <td id="file-velero-create-sa-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-velero-create-sa-LC2" class="blob-code blob-code-inner js-file-line">SERVICE_ACCOUNT_EMAIL=$(gcloud iam service-accounts list –filter="displayName:Velero SA" –format 'value(email)')</td> </tr> <tr> <td id="file-velero-create-sa-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-velero-create-sa-LC3" class="blob-code blob-code-inner js-file-line">gcloud iam service-accounts list</td> </tr> <tr> <td id="file-velero-create-sa-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td> <td id="file-velero-create-sa-LC4" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-velero-create-sa-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td> <td id="file-velero-create-sa-LC5" class="blob-code blob-code-inner js-file-line">ROLE_PERMISSIONS=(</td> </tr> <tr> <td id="file-velero-create-sa-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td> <td id="file-velero-create-sa-LC6" class="blob-code blob-code-inner js-file-line"> compute.disks.get</td> </tr> <tr> <td id="file-velero-create-sa-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td> <td id="file-velero-create-sa-LC7" class="blob-code blob-code-inner js-file-line"> compute.disks.create</td> </tr> <tr> <td id="file-velero-create-sa-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td> <td id="file-velero-create-sa-LC8" class="blob-code blob-code-inner js-file-line"> compute.disks.createSnapshot</td> </tr> <tr> <td id="file-velero-create-sa-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td> <td id="file-velero-create-sa-LC9" class="blob-code blob-code-inner js-file-line"> compute.snapshots.get</td> </tr> <tr> <td id="file-velero-create-sa-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td> <td id="file-velero-create-sa-LC10" class="blob-code blob-code-inner js-file-line"> compute.snapshots.create</td> </tr> <tr> <td id="file-velero-create-sa-L11" class="blob-num js-line-number js-blob-rnum" data-line-number="11"></td> <td id="file-velero-create-sa-LC11" class="blob-code blob-code-inner js-file-line"> compute.snapshots.useReadOnly</td> </tr> <tr> <td id="file-velero-create-sa-L12" class="blob-num js-line-number js-blob-rnum" data-line-number="12"></td> <td id="file-velero-create-sa-LC12" class="blob-code blob-code-inner js-file-line"> compute.snapshots.delete</td> </tr> <tr> <td id="file-velero-create-sa-L13" class="blob-num js-line-number js-blob-rnum" data-line-number="13"></td> <td id="file-velero-create-sa-LC13" class="blob-code blob-code-inner js-file-line"> compute.zones.get</td> </tr> <tr> <td id="file-velero-create-sa-L14" class="blob-num js-line-number js-blob-rnum" data-line-number="14"></td> <td id="file-velero-create-sa-LC14" class="blob-code blob-code-inner js-file-line">)</td> </tr> <tr> <td id="file-velero-create-sa-L15" class="blob-num js-line-number js-blob-rnum" data-line-number="15"></td> <td id="file-velero-create-sa-LC15" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-velero-create-sa-L16" class="blob-num js-line-number js-blob-rnum" data-line-number="16"></td> <td id="file-velero-create-sa-LC16" class="blob-code blob-code-inner js-file-line">gcloud iam roles create velero.server –project $PROJECT_ID –title "Velero SA" –permissions "$(IFS=","; echo "${ROLE_PERMISSIONS[*]}")"</td> </tr> <tr> <td id="file-velero-create-sa-L17" class="blob-num js-line-number js-blob-rnum" data-line-number="17"></td> <td id="file-velero-create-sa-LC17" class="blob-code blob-code-inner js-file-line">gcloud projects add-iam-policy-binding $PROJECT_ID –member serviceAccount:$SERVICE_ACCOUNT_EMAIL –role projects/$PROJECT_ID/roles/velero.server</td> </tr> <tr> <td id="file-velero-create-sa-L18" class="blob-num js-line-number js-blob-rnum" data-line-number="18"></td> <td id="file-velero-create-sa-LC18" class="blob-code blob-code-inner js-file-line">gsutil iam ch serviceAccount:$SERVICE_ACCOUNT_EMAIL:objectAdmin gs://${BUCKET}</td> </tr> <tr> <td id="file-velero-create-sa-L19" class="blob-num js-line-number js-blob-rnum" data-line-number="19"></td> <td id="file-velero-create-sa-LC19" class="blob-code blob-code-inner js-file-line">gcloud iam service-accounts keys create credentials-velero –iam-account $SERVICE_ACCOUNT_EMAIL</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/e6977478352f81037e8b22b7ff01d280/raw/ad81d91835acddf309fa6e80c5aed7c6e2821f6d/velero-create-sa" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/e6977478352f81037e8b22b7ff01d280#file-velero-create-sa" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> velero-create-sa </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="340" data-attachment-id="10782" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-4-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png" data-orig-size="1366,454" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-4" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png?w=1024" alt="" class="wp-image-10782" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-4.png 1366w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="103" data-attachment-id="10784" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-5-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png" data-orig-size="1366,138" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-5" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png?w=1024" alt="" class="wp-image-10784" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-5.png 1366w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>After the permission is configured, we now have to download the Velero. There are many architectures provided, and we can just choose it right away</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118729094" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-velero-install" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="velero-install content, created by misskecupbung on 06:51PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="velero-install"> <tr> <td id="file-velero-install-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-velero-install-LC1" class="blob-code blob-code-inner js-file-line">wget -c <a href="https://github.com/vmware-tanzu/velero/releases/download/v1.9.2/&lt;RELEASE-TARBALL-NAME&amp;gt" rel="nofollow" target="_blank">https://github.com/vmware-tanzu/velero/releases/download/v1.9.2/&lt;RELEASE-TARBALL-NAME&amp;gt</a>;.tar.gz</td> </tr> <tr> <td id="file-velero-install-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-velero-install-LC2" class="blob-code blob-code-inner js-file-line">tar -xvf &lt;RELEASE-TARBALL-NAME&gt;.tar.gz</td> </tr> <tr> <td id="file-velero-install-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-velero-install-LC3" class="blob-code blob-code-inner js-file-line">sudo cp &lt;RELEASE-TARBALL-NAME&gt;/velero /usr/bin/</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/83f6eb22fae1e421a7ca4da721434a33/raw/9aa40a6323c1f3126b4b62d6c81813a03e58aeda/velero-install" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/83f6eb22fae1e421a7ca4da721434a33#file-velero-install" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> velero-install </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="281" data-attachment-id="10791" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-8-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png" data-orig-size="1027,282" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-8" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png?w=1024" alt="" class="wp-image-10791" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-8.png 1027w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>And install it. Don’t forget to use GCP as the plugin and define the secret file to the secret file created earlier before. This is important, so the Velero can connect to the bucket </p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118729193" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-velero-install-1" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="velero-install-1 content, created by misskecupbung on 06:57PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="velero-install-1"> <tr> <td id="file-velero-install-1-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-velero-install-1-LC1" class="blob-code blob-code-inner js-file-line">velero install –provider gcp –plugins velero/velero-plugin-for-gcp:v1.5.0 –bucket velero-backup –secret-file ./credentials-velero –use-volume-snapshots=true</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/835572cb00eb6d87bdfcfec96ea60977/raw/edeaf39462aba7284acdfe81adc8ad0af66ef445/velero-install-1" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/835572cb00eb6d87bdfcfec96ea60977#file-velero-install-1" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> velero-install-1 </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="84" data-attachment-id="10792" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-9-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png" data-orig-size="1341,111" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-9" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png?w=1024" alt="" class="wp-image-10792" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png?w=1015 1015w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-9.png 1341w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>Okay. Now Velero is ready to use.</p> <p></p> <p>In this journal, for example, below is my GKE cluster. I am using Kubernetes with the version 1.22.12, and it has three workers nodes. </p> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="197" data-attachment-id="10788" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-7-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png" data-orig-size="1366,264" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-7" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png?w=1024" alt="" class="wp-image-10788" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png?w=1019 1019w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-7.png 1366w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>And there, I already deployed a wordpress application that uses PVC for storage and services with LoadBalancer type. You can follow along <a href="https://kubernetes.io/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/" rel="external nofollow noopener" target="_blank">here</a>.</p> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="622" data-attachment-id="10809" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-18-13/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png" data-orig-size="1027,624" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-18" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png?w=1024" alt="" class="wp-image-10809" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-18.png 1027w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>There are many ways to do a backup. We can backup based on the namespace, on the label, and even the entire cluster, including cluster state. This depends on the use case. For example, I only want to do backup-specific namespace or deployment based on the label. </p> <p>Here is the example if I only want to do a backup for wordpress namespace</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118729512" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-velero-backup-ns-wordpress" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="velero-backup-ns-wordpress content, created by misskecupbung on 07:18PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="velero-backup-ns-wordpress"> <tr> <td id="file-velero-backup-ns-wordpress-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-velero-backup-ns-wordpress-LC1" class="blob-code blob-code-inner js-file-line">velero backup create wp-backup –include-namespace wordpress</td> </tr> <tr> <td id="file-velero-backup-ns-wordpress-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-velero-backup-ns-wordpress-LC2" class="blob-code blob-code-inner js-file-line">velero backup get</td> </tr> <tr> <td id="file-velero-backup-ns-wordpress-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td> <td id="file-velero-backup-ns-wordpress-LC3" class="blob-code blob-code-inner js-file-line">velero backup describe wp-backup</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/682a992143fedcef947b8597f8380fb8/raw/e81bcd19de056b46edddff2be9798d1fabb68310/velero-backup-ns-wordpress" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/682a992143fedcef947b8597f8380fb8#file-velero-backup-ns-wordpress" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> velero-backup-ns-wordpress </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="177" data-attachment-id="10810" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-19-13/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png" data-orig-size="1079,187" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-19" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png?w=1024" alt="" class="wp-image-10810" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-19.png 1079w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="409" data-attachment-id="10796" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-11-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png" data-orig-size="1138,455" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-11" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png?w=1024" alt="" class="wp-image-10796" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-11.png 1138w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>In another moment, we can do a backup automatically by scheduling it as daily like below</p> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="134" data-attachment-id="10798" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-12-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png" data-orig-size="1181,155" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-12" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png?w=1024" alt="" class="wp-image-10798" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-12.png 1181w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p>The resources will automatically back up into the storage defined before.</p> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="532" data-attachment-id="10802" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-15-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png" data-orig-size="1135,590" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-15" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png?w=1024" alt="" class="wp-image-10802" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-15.png 1135w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <p>After backup is successful, how do restore it? For testing, we can delete the deployment first and try to restore it in the same cluster. Or if we have another cluster, we can restore it there too.</p> <figure class="wp-block-embed is-type-rich is-provider-embed-handler wp-block-embed-embed-handler"><div class="wp-block-embed__wrapper"> <style>.gist table{margin-bottom:0}</style> <div style="tab-size: 8" id="gist118730000" class="gist"> <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container"> <div id="file-velero-restore" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text " style="overflow: auto" tabindex="0" role="region" aria-label="velero-restore content, created by misskecupbung on 07:52PM on October 06, 2022."> <div class="js-check-hidden-unicode js-blob-code-container blob-code-content"> <template class="js-file-alert-template"> <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> <span> This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. <a class="Link--inTextBlock" href="https://github.co/hiddenchars" target="_blank" rel="external nofollow noopener">Learn more about bidirectional Unicode characters</a> </span> <div data-view-component="true" class="flash-action"> <a href="" data-view-component="true" class="btn-sm btn"> Show hidden characters </a> </div> </div></template> <template class="js-line-alert-template"> <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e"> <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert"> <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path> </svg> </span></template> <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="velero-restore"> <tr> <td id="file-velero-restore-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td> <td id="file-velero-restore-LC1" class="blob-code blob-code-inner js-file-line">BACKUP_NAME = wp-backup</td> </tr> <tr> <td id="file-velero-restore-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td> <td id="file-velero-restore-LC2" class="blob-code blob-code-inner js-file-line">velero restore create –from-backup $BACKUP_NAME</td> </tr> </table> </div> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/misskecupbung/5fec11105d2d741c0fa1499e91a64d4f/raw/7ceaccaf4e112df21fd8b1db527c7c94be306295/velero-restore" style="float:right" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank">view raw</a> <a href="https://gist.github.com/misskecupbung/5fec11105d2d741c0fa1499e91a64d4f#file-velero-restore" class="Link--inTextBlock" rel="external nofollow noopener" target="_blank"> velero-restore </a> hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com" rel="external nofollow noopener" target="_blank">GitHub</a> </div> </div> </div> </div></figure> <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="351" data-attachment-id="10804" data-permalink="https://misskecupbung.wordpress.com/2022/10/07/google-cloud-backup-and-restore-our-gke-workloads-using-velero/image-16-14/" data-orig-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png" data-orig-size="1091,374" data-comments-opened="1" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-image-title="image-16" data-image-description="" data-image-caption="" data-medium-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png?w=300" data-large-file="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png?w=616" src="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png?w=1024" alt="" class="wp-image-10804" srcset="https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png?w=1024 1024w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png?w=150 150w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png?w=300 300w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png?w=768 768w, https://misskecupbung.wordpress.com/wp-content/uploads/2022/10/image-16.png 1091w" sizes="(max-width: 1024px) 100vw, 1024px"></figure> <p></p> <p></p> <p></p> <p>References:</p> <ol class="wp-block-list"> <li><a href="https://velero.io/docs/v1.9/" rel="external nofollow noopener" target="_blank">https://velero.io/docs/v1.9/</a></li> <li><a href="https://gist.github.com/rcompos/adc4f0dd00e37df023fd78c5db7965ef" rel="external nofollow noopener" target="_blank">https://gist.github.com/rcompos/adc4f0dd00e37df023fd78c5db7965ef</a></li> <li><a href="https://github.com/vmware-tanzu/velero-plugin-for-gcp" rel="external nofollow noopener" target="_blank">https://github.com/vmware-tanzu/velero-plugin-for-gcp</a></li> </ol> <p></p> <p></p> <p>Cheers!</p> </body></html>